<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SG Xiangqi - Login</title>
    <style>
        :root { --primary: #cd3333; --dark: #2c3e50; --bg: #f4f7f6; --gray: #64748b; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: var(--bg); 
            display: flex; justify-content: center; align-items: center; 
            height: 100vh; margin: 0; 
        }
        .login-card {
            background: white; padding: 40px; border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1); width: 100%; max-width: 400px;
            text-align: center;
        }
        
        /* Logo Styling */
        .logo-container {
            margin-bottom: 20px;
        }
        .logo-container img {
            width: 100px;
            height: 100px;
            object-fit: contain;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
            transition: transform 0.3s ease;
        }
        .logo-container img:hover {
            transform: scale(1.05);
        }

        h1 { color: var(--primary); margin-bottom: 5px; font-size: 1.8rem; font-weight: 800; letter-spacing: -0.5px; }
        p.subtitle { color: var(--gray); margin-bottom: 30px; font-size: 0.95rem; }
        
        .form-group { margin-bottom: 20px; text-align: left; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: var(--dark); font-size: 0.9rem; }
        
        input[type="email"], input[type="password"] { 
            width: 100%; padding: 12px 16px; border: 1px solid #ddd; 
            border-radius: 10px; box-sizing: border-box; font-size: 1rem;
            background: #fdfdfd; transition: all 0.2s;
        }
        input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(205, 51, 51, 0.1); }
        
        .checkbox-group {
            display: flex; align-items: center; margin-bottom: 20px;
            font-size: 0.9rem; color: var(--dark); cursor: pointer;
        }
        .checkbox-group input { margin-right: 10px; width: auto; cursor: pointer; }
        
        button {
            width: 100%; padding: 14px; background: var(--primary); color: white;
            border: none; border-radius: 10px; font-size: 1rem; font-weight: bold;
            cursor: pointer; transition: all 0.3s;
        }
        button:hover { background: #a02828; transform: translateY(-1px); box-shadow: 0 4px 12px rgba(205, 51, 51, 0.2); }
        button:active { transform: translateY(0); }

        .error-msg { color: #e74c3c; margin-top: 15px; font-size: 0.85rem; display: none; padding: 10px; background: #fee2e2; border-radius: 8px; }
        .success-msg { color: #27ae60; margin-top: 15px; font-size: 0.85rem; display: none; padding: 10px; background: #dcfce7; border-radius: 8px; }
        
        .loading-spinner {
            display: none; width: 22px; height: 22px; border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%; border-top-color: #fff; animation: spin 1s infinite linear;
            margin: 0 auto;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Footer Links */
        .footer-links {
            margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;
            font-size: 0.85rem; color: var(--gray);
        }
        .footer-links div { margin-bottom: 12px; }
        .link { color: var(--primary); text-decoration: none; font-weight: bold; cursor: pointer; }
        .link:hover { text-decoration: underline; }
    </style>
</head>
<body>

<div class="login-card">
    <div class="logo-container">
        <!-- Main Logo: Singapore.png relocated to pictures folder -->
        <img src="pictures/Singapore.png" alt="Singapore Symbol" onerror="this.style.display='none'">
    </div>
    <h1>SG Xiangqi</h1>
    <p class="subtitle">Sign in to join the lobby</p>
    
    <div class="form-group">
        <label>Email Address</label>
        <input type="email" id="email" placeholder="name@example.com">
    </div>
    <div class="form-group">
        <label>Password</label>
        <input type="password" id="password" placeholder="••••••••">
    </div>

    <div class="form-group">
        <label class="checkbox-group">
            <input type="checkbox" id="admin-checkbox">
            Login as Administrator
        </label>
    </div>
    
    <button id="login-btn">
        <span id="btn-text">Sign In</span>
        <div id="btn-loader" class="loading-spinner"></div>
    </button>
    
    <div id="error-box" class="error-msg"></div>
    <div id="success-box" class="success-msg"></div>

    <div class="footer-links">
        <div>New player? <a href="register.html" class="link">Create Account</a></div>
        <div><span class="link" id="forgot-password-btn">Forgot Password?</span></div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDq_LECOrc4SY90SyDsBQGmwl-YnUNFIj8",
        authDomain: "xiangqi-sq.firebaseapp.com",
        projectId: "xiangqi-sq",
        storageBucket: "xiangqi-sq.firebasestorage.app",
        messagingSenderId: "351923336298",
        appId: "1:351923336298:web:e7278ea095ba085ac4935b"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    const emailInput = document.getElementById('email');
    const passInput = document.getElementById('password');
    const adminCheckbox = document.getElementById('admin-checkbox');
    const loginBtn = document.getElementById('login-btn');
    const forgotBtn = document.getElementById('forgot-password-btn');
    const errorBox = document.getElementById('error-box');
    const successBox = document.getElementById('success-box');
    const btnText = document.getElementById('btn-text');
    const btnLoader = document.getElementById('btn-loader');

    // NOTE: Auto-redirect on page load is removed so you can see the form.
    // The redirection only happens after a successful Sign In click.

    loginBtn.addEventListener('click', async () => {
        const email = emailInput.value;
        const password = passInput.value;

        if (!email || !password) {
            showError("Please fill in all fields.");
            return;
        }

        clearMessages();
        btnText.style.display = "none";
        btnLoader.style.display = "block";
        loginBtn.disabled = true;

        try {
            await signInWithEmailAndPassword(auth, email, password);
            // Redirection happens ONLY after successful sign-in
            if (adminCheckbox.checked) {
                window.location.href = 'admin.html';
            } else {
                window.location.href = 'lobby/lobby.html';
            }
        } catch (error) {
            showError("Invalid email or password.");
            btnText.style.display = "block";
            btnLoader.style.display = "none";
            loginBtn.disabled = false;
        }
    });

    forgotBtn.addEventListener('click', async () => {
        const email = emailInput.value.trim();
        if (!email) {
            showError("Please enter your email address first.");
            return;
        }

        clearMessages();
        try {
            await sendPasswordResetEmail(auth, email);
            showSuccess("Password reset link sent to your email!");
        } catch (error) {
            if (error.code === 'auth/user-not-found') {
                showError("No user found with this email.");
            } else {
                showError("Error sending reset link. Try again later.");
            }
        }
    });

    function showError(msg) {
        errorBox.innerText = msg;
        errorBox.style.display = "block";
        successBox.style.display = "none";
    }

    function showSuccess(msg) {
        successBox.innerText = msg;
        successBox.style.display = "block";
        errorBox.style.display = "none";
    }

    function clearMessages() {
        errorBox.style.display = "none";
        successBox.style.display = "none";
    }
</script>

</body>
</html>